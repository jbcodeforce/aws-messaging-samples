<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Jerome Boyer"><link rel=prev href=..><link href=../amazonmq/ rel=next><link rel=icon href=../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.0, mkdocs-material-9.5.27"><title>Active MQ - AWS Messaging Studies</title><link rel=stylesheet href=../assets/stylesheets/main.6543a935.min.css><link rel=stylesheet href=../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../extra.css><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#active-mq class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=.. title="AWS Messaging Studies" class="md-header__button md-logo" aria-label="AWS Messaging Studies" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> AWS Messaging Studies </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Active MQ </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/jbcodeforce/aws-messaging-study.git title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title="AWS Messaging Studies" class="md-nav__button md-logo" aria-label="AWS Messaging Studies" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> AWS Messaging Studies </label> <div class=md-nav__source> <a href=https://github.com/jbcodeforce/aws-messaging-study.git title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> <span class=md-ellipsis> Introduction </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Active MQ </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Active MQ </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#the-open-source-project class=md-nav__link> <span class=md-ellipsis> The Open Source project </span> </a> <nav class=md-nav aria-label="The Open Source project"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#value-propositions class=md-nav__link> <span class=md-ellipsis> Value propositions </span> </a> </li> <li class=md-nav__item> <a href=#configurations class=md-nav__link> <span class=md-ellipsis> Configurations </span> </a> </li> <li class=md-nav__item> <a href=#monitoring class=md-nav__link> <span class=md-ellipsis> Monitoring </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#active-mq-topologies class=md-nav__link> <span class=md-ellipsis> Active MQ Topologies </span> </a> <nav class=md-nav aria-label="Active MQ Topologies"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#mesh class=md-nav__link> <span class=md-ellipsis> Mesh </span> </a> </li> <li class=md-nav__item> <a href=#hub-and-spoke class=md-nav__link> <span class=md-ellipsis> Hub and Spoke </span> </a> </li> <li class=md-nav__item> <a href=#connection-from-client-app class=md-nav__link> <span class=md-ellipsis> Connection from client app </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#storage class=md-nav__link> <span class=md-ellipsis> Storage </span> </a> </li> <li class=md-nav__item> <a href=#faqs class=md-nav__link> <span class=md-ellipsis> FAQs </span> </a> </li> <li class=md-nav__item> <a href=#code-samples class=md-nav__link> <span class=md-ellipsis> Code samples </span> </a> </li> <li class=md-nav__item> <a href=#to-address-in-the-future class=md-nav__link> <span class=md-ellipsis> To address in the future </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../amazonmq/ class=md-nav__link> <span class=md-ellipsis> Amazon MQ </span> </a> </li> <li class=md-nav__item> <a href=../sqs/ class=md-nav__link> <span class=md-ellipsis> Amazon SQS </span> </a> </li> <li class=md-nav__item> <a href=../sns/ class=md-nav__link> <span class=md-ellipsis> Amazon SNS </span> </a> </li> <li class=md-nav__item> <a href=../rabbitmq/ class=md-nav__link> <span class=md-ellipsis> Rabbit MQ </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex=0> <span class=md-ellipsis> Labs </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Labs </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_1> <label class=md-nav__link for=__nav_7_1 id=__nav_7_1_label tabindex=0> <span class=md-ellipsis> Active MQ </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_1_label aria-expanded=false> <label class=md-nav__title for=__nav_7_1> <span class="md-nav__icon md-icon"></span> Active MQ </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../labs/aq-aws-console-lab/ class=md-nav__link> <span class=md-ellipsis> Via AWS Console </span> </a> </li> <li class=md-nav__item> <a href=../labs/activemq-monitoring/ class=md-nav__link> <span class=md-ellipsis> ActiveMQ monitoring </span> </a> </li> <li class=md-nav__item> <a href=../labs/activemq-ldap-sec/ class=md-nav__link> <span class=md-ellipsis> Active MQ security </span> </a> </li> <li class=md-nav__item> <a href=../labs/ow-pt-to-pt-jms/ class=md-nav__link> <span class=md-ellipsis> One way pt-to-pt JMS </span> </a> </li> <li class=md-nav__item> <a href=../labs/activemq-cdk/ class=md-nav__link> <span class=md-ellipsis> ActiveMQ with CDK </span> </a> </li> <li class=md-nav__item> <a href=../labs/failover-lab/ class=md-nav__link> <span class=md-ellipsis> Failover to standby </span> </a> </li> <li class=md-nav__item> <a href=../labs/classic-req-reply-jms/ class=md-nav__link> <span class=md-ellipsis> JMS Req-ReplyTo </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_2> <label class=md-nav__link for=__nav_7_2 id=__nav_7_2_label tabindex=0> <span class=md-ellipsis> SQS </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_2_label aria-expanded=false> <label class=md-nav__title for=__nav_7_2> <span class="md-nav__icon md-icon"></span> SQS </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../labs/sqs/ class=md-nav__link> <span class=md-ellipsis> Basic </span> </a> </li> <li class=md-nav__item> <a href=../labs/sqs/s3-tenants-async-processing/ class=md-nav__link> <span class=md-ellipsis> S3-multi-tenant-event </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../req-reply-jms/ class=md-nav__link> <span class=md-ellipsis> Artemis JMS Req-ReplyTo </span> </a> </li> <li class=md-nav__item> <a href=../labs/ibm-mq/ class=md-nav__link> <span class=md-ellipsis> IBM MQ labs </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#the-open-source-project class=md-nav__link> <span class=md-ellipsis> The Open Source project </span> </a> <nav class=md-nav aria-label="The Open Source project"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#value-propositions class=md-nav__link> <span class=md-ellipsis> Value propositions </span> </a> </li> <li class=md-nav__item> <a href=#configurations class=md-nav__link> <span class=md-ellipsis> Configurations </span> </a> </li> <li class=md-nav__item> <a href=#monitoring class=md-nav__link> <span class=md-ellipsis> Monitoring </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#active-mq-topologies class=md-nav__link> <span class=md-ellipsis> Active MQ Topologies </span> </a> <nav class=md-nav aria-label="Active MQ Topologies"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#mesh class=md-nav__link> <span class=md-ellipsis> Mesh </span> </a> </li> <li class=md-nav__item> <a href=#hub-and-spoke class=md-nav__link> <span class=md-ellipsis> Hub and Spoke </span> </a> </li> <li class=md-nav__item> <a href=#connection-from-client-app class=md-nav__link> <span class=md-ellipsis> Connection from client app </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#storage class=md-nav__link> <span class=md-ellipsis> Storage </span> </a> </li> <li class=md-nav__item> <a href=#faqs class=md-nav__link> <span class=md-ellipsis> FAQs </span> </a> </li> <li class=md-nav__item> <a href=#code-samples class=md-nav__link> <span class=md-ellipsis> Code samples </span> </a> </li> <li class=md-nav__item> <a href=#to-address-in-the-future class=md-nav__link> <span class=md-ellipsis> To address in the future </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=active-mq>Active MQ<a class=headerlink href=#active-mq title="Permanent link">&para;</a></h1> <p>This section is a quick summary from <a href=https://activemq.apache.org/components/artemis/documentation/ >ActiveMQ Artemis version product documentation</a>, ActiveMQ <a href=https://activemq.apache.org/components/classic/documentation>classic documentation</a> and Amazon MQ <a href=https://docs.aws.amazon.com/amazon-mq/latest/developer-guide/working-with-activemq.html>ActiveMQ engine documentation</a> for Active MQ 5.17.3 deployment as a managed service.</p> <h2 id=the-open-source-project><a href=https://activemq.apache.org/ >The Open Source project</a><a class=headerlink href=#the-open-source-project title="Permanent link">&para;</a></h2> <p>Active MQ is an Open Source software, multi-protocol, java based message broker. ActiveMQ has two main version of the product Active MQ 5.x (or classic) and Artemis 2.x which supports Jakarta Messsaging 3.1. It also supports embedding the broker in a java app.</p> <p>It supports message load balancing, HA. Multiple connected "master" brokers can dynamically respond to consumer demand by moving messages between the nodes in the background.</p> <p>Amazon MQ - Active MQ engine supports the Classic version.</p> <p>Active MQ supports different messaging patterns: <strong>queue</strong> and <strong>topic</strong>:</p> <ul> <li>Queue supports point to point, and request/replyTo pattern.</li> <li>Queue can have multiple senders and consumers, the message will be load balanced between consumers. Messages acknowledged are removed from the queue.</li> <li> <p>Message with a TTL will be removed from queue, without being consumed.</p> </li> <li> <p>Topic supports pub/sub.</p> </li> <li>With Topic, receiver starts to receive only the new messages, that are being sent by the sender. Messages sent to topic without consumer are lost.</li> <li>Topics support the fan-out pattern. All Messages sent by any senders are received by all connected receivers.</li> </ul> <h3 id=value-propositions>Value propositions<a class=headerlink href=#value-propositions title="Permanent link">&para;</a></h3> <ul> <li>Java 11+, JMS 2.0, Jakarta Messaging 3.0</li> <li><a href=https://activemq.apache.org/protocols>Protocols</a> supported: STOMP, AMQP, <a href=https://activemq.apache.org/wire-protocol>OpenWire</a>, MQTT, NMS (.Net), CMS (C++), HornetQ, core Artemis API.</li> <li>Support Queues and Topics for pub/sub</li> <li>Performance with message persistence.</li> <li>Integrated with Java EE application server or embbeded in a java app, or standalone using lightweight netty server.</li> <li>HA solution with automatic client failover</li> <li>Flexible clustering</li> <li>Messages can be ordered by message group</li> <li>Message filtering using selectors to perform content based routing</li> <li>Unlimited message size so there is not need to plan for unexpected messages</li> <li>Message Delay and scheduling</li> <li>Distribute transactions to manage complex multi stage transactions such as database access</li> <li>Virtual Topics and composite destinations</li> <li>Complex redelivery policy</li> </ul> <h3 id=configurations>Configurations<a class=headerlink href=#configurations title="Permanent link">&para;</a></h3> <p>A configuration contains all of the settings for the ActiveMQ brokers, in XML format. See the <a href=https://activemq.apache.org/version-5-xml-configuration>product documentation</a> to get what can be defined.</p> <p>The configuration parts to consider for any deployment:</p> <ul> <li>What transport connector to enable for which protocol (amqp, openwire, ...).</li> <li>What persistence to use as backend to save messages until read. The default persistence mechanism is the KahaDB store.</li> <li>The need to expose JMX</li> <li>Control Flow for back preassure management in case of slow consumers. Persistence time.</li> </ul> <p>It is possible to configure users and groups, and then the <code>authorizationMap</code> so a specific queue or topic can only be accessed by a specific user/app (The declaration below, allows user1 to manage, write and read from <code>queue.user1</code>, but not user2, who is allowed admin, read and write on <code>topic.user2</code>): </p> <div class=highlight><pre><span></span><code><span class=nt>&lt;authorizationPlugin&gt;</span>
<span class=w>    </span><span class=nt>&lt;map&gt;</span>
<span class=w>    </span><span class=nt>&lt;authorizationMap&gt;</span>
<span class=w>        </span><span class=nt>&lt;authorizationEntries&gt;</span>
<span class=w>          </span><span class=nt>&lt;authorizationEntry</span><span class=w> </span><span class=na>admin=</span><span class=s>&quot;admin,activemq-webconsole&quot;</span><span class=w> </span><span class=na>queue=</span><span class=s>&quot;&amp;gt;&quot;</span><span class=w> </span><span class=na>read=</span><span class=s>&quot;admin,activemq-webconsole&quot;</span><span class=w> </span><span class=na>write=</span><span class=s>&quot;admin,activemq-webconsole&quot;</span><span class=nt>/&gt;</span>
<span class=w>          </span><span class=nt>&lt;authorizationEntry</span><span class=w> </span><span class=na>admin=</span><span class=s>&quot;admin,activemq-webconsole&quot;</span><span class=w> </span><span class=na>topic=</span><span class=s>&quot;&amp;gt;&quot;</span><span class=w> </span><span class=na>read=</span><span class=s>&quot;admin,activemq-webconsole&quot;</span><span class=w> </span><span class=na>write=</span><span class=s>&quot;admin,activemq-webconsole&quot;</span><span class=nt>/&gt;</span>
<span class=w>          </span><span class=nt>&lt;authorizationEntry</span><span class=w> </span><span class=na>admin=</span><span class=s>&quot;admin,user1&quot;</span><span class=w> </span><span class=na>queue=</span><span class=s>&quot;queue.user1&quot;</span><span class=w> </span><span class=na>read=</span><span class=s>&quot;user1&quot;</span><span class=w> </span><span class=na>write=</span><span class=s>&quot;user1&quot;</span><span class=nt>/&gt;</span>
<span class=w>          </span><span class=nt>&lt;authorizationEntry</span><span class=w> </span><span class=na>admin=</span><span class=s>&quot;admin,user2&quot;</span><span class=w> </span><span class=na>read=</span><span class=s>&quot;user2&quot;</span><span class=w> </span><span class=na>topic=</span><span class=s>&quot;topic.user2&quot;</span><span class=w> </span><span class=na>write=</span><span class=s>&quot;user2&quot;</span><span class=nt>/&gt;</span>
<span class=w>          </span><span class=nt>&lt;authorizationEntry</span><span class=w> </span><span class=na>admin=</span><span class=s>&quot;admin,user1,user2&quot;</span><span class=w> </span><span class=na>read=</span><span class=s>&quot;admin,user1,user2&quot;</span><span class=w> </span><span class=na>topic=</span><span class=s>&quot;ActiveMQ.Advisory.&amp;gt;&quot;</span><span class=w> </span><span class=na>write=</span><span class=s>&quot;admin,user1,user2&quot;</span><span class=nt>/&gt;</span>
<span class=w>        </span><span class=nt>&lt;/authorizationEntries&gt;</span>
<span class=w>        </span><span class=nt>&lt;tempDestinationAuthorizationEntry&gt;</span>
<span class=w>        </span><span class=nt>&lt;tempDestinationAuthorizationEntry</span><span class=w> </span><span class=na>admin=</span><span class=s>&quot;tempDestinationAdmins&quot;</span><span class=w> </span><span class=na>read=</span><span class=s>&quot;tempDestinationAdmins&quot;</span><span class=w> </span><span class=na>write=</span><span class=s>&quot;tempDestinationAdmins&quot;</span><span class=nt>/&gt;</span>
<span class=w>        </span><span class=nt>&lt;/tempDestinationAuthorizationEntry&gt;</span>
<span class=w>    </span><span class=nt>&lt;/authorizationMap&gt;</span>
<span class=w>    </span><span class=nt>&lt;/map&gt;</span>
<span class=nt>&lt;/authorizationPlugin&gt;</span>
</code></pre></div> <p>In order to apply the modifications done to the broker configuration, the broker must be rebooted. A reboot can be scheduled, and use specific configuration revision to specify which configuration updates to apply.</p> <h3 id=monitoring>Monitoring<a class=headerlink href=#monitoring title="Permanent link">&para;</a></h3> <p>Most of the management and monitoring is done via the Console or the JMX MBeans. See the <a href=../labs/activemq-monitoring/ >monitoring Lab</a> for JMX local management, and Amazon MQ monitoring.</p> <h2 id=active-mq-topologies>Active MQ Topologies<a class=headerlink href=#active-mq-topologies title="Permanent link">&para;</a></h2> <p>The <a href=https://activemq.apache.org/components/artemis/documentation/ >Active product documentation HA chapter</a> gives all the details on the different topologies supported. Here are the important points to remember:</p> <ul> <li>Use Live/backup node groups when more than two brokers are used.</li> <li>A backup server is owned by only one live server.</li> <li>Two strategies for backing up a server <strong>shared store</strong> and <strong>replication</strong>.</li> <li> <p>When using a <strong>shared store</strong>, both live and backup servers share the same entire data directory using a <strong>shared file system</strong> (SAN).</p> <p><img alt src=../diagrams/amq-shared-st.drawio.png></p> <p><strong>Figure 1: Active/standby shared storage</strong></p> </li> <li> <p>Only persistent message data will survive failover.</p> </li> <li> <p>With <strong>replication</strong> the data filesystem is not shared, but replicated from live to standby. At start-up the backup server will first need to synchronize all existing data from the live server, which brings lag. This could be minimized.</p> <p><img alt src=../diagrams/amq-replica.drawio.png></p> <p><strong>Figure 2: Active/standby replicate storage</strong></p> </li> <li> <p>With replicas when live broker restarts and failbacks, it will replicate data from the backup broker with the most fresh messages.</p> </li> <li>Brokers with replication are part of a cluster. So <code>broker.xml</code> needs to include cluster connection. Live | backup brokers are in the same node-group.</li> </ul> <h3 id=mesh>Mesh<a class=headerlink href=#mesh title="Permanent link">&para;</a></h3> <p>We can choose a network of brokers with multiple active/standby brokers, like a broker Mesh. This topology is used to increase the number of client applications. Any one of the two Active/Stanby brokers can be active at a time with messages stored in a <strong>shared durable storage</strong>. There is no single point of failure as in client/server or hub and spoke topologies. A client can failover another broker improving high availability. </p> <p>The following diagram illustrates a configuration over 3 AZs, and the corresponding <a href=https://s3.amazonaws.com/amazon-mq-workshop/CreateAmazonMQWorkshop.yaml>CloudFormation template can be found here</a>.</p> <p><img alt src=../diagrams/mq-mesh.drawio.png></p> <p><strong>Figure 3: Active MQ mesh cluster deployment</strong></p> <p>Each broker can accept connections from clients. The client endpoints are named <code>TransportConnectors</code>. Any client connecting to a broker uses a failover string that defines each broker that the client can connect to send or receive messages.</p> <div class=highlight><pre><span></span><code>amqp+ssl://b-5......87c1e-1.mq.us-west-2.amazonaws.com:5671
amqp+ssl://b-5......87c1e-2.mq.us-west-2.amazonaws.com:5671
</code></pre></div> <p>In order to scale, client connections can be divided across brokers. </p> <p>Because those brokers are all connected using network connectors, when a producer sends messages to say NoB1, the messages can be consumed from NoB2 or from NoB3. This is because <code>conduitSubscriptions</code> is set to false.</p> <p>Essentially we send messages to any brokers, and the messages can still be read from a different brokers.</p> <p>Brokers are connected with each other using <code>OpenWire</code> network connectors. Within each broker configuration, for each queue and topic, there are a set of <code>networkConnector</code> items defining connection from the current broker and to the two other brokers in the mesh. So each broker has a different networkConnector, to pair to each other broker.</p> <div class=highlight><pre><span></span><code><span class=w>  </span><span class=nt>&lt;networkConnectors&gt;</span>
<span class=w>    </span><span class=nt>&lt;networkConnector</span><span class=w> </span><span class=na>conduitSubscriptions=</span><span class=s>&quot;false&quot;</span><span class=w> </span><span class=na>consumerTTL=</span><span class=s>&quot;1&quot;</span><span class=w> </span><span class=na>messageTTL=</span><span class=s>&quot;-1&quot;</span><span class=w> </span><span class=na>name=</span><span class=s>&quot;QueueConnector_ConnectingBroker_1_To_2&quot;</span><span class=w> </span><span class=na>uri=</span><span class=s>&quot;masterslave:(ssl://b-c2....2-1.mq.us-west-2.amazonaws.com:61617,ssl://b-c2...2-2.mq.us-west-2.amazonaws.com:61617)&quot;</span><span class=w> </span><span class=na>userName=</span><span class=s>&quot;mqadmin&quot;</span><span class=nt>&gt;</span>
<span class=w>      </span><span class=nt>&lt;excludedDestinations&gt;</span>
<span class=w>        </span><span class=nt>&lt;topic</span><span class=w> </span><span class=na>physicalName=</span><span class=s>&quot;&amp;gt;&quot;</span><span class=nt>/&gt;</span>
<span class=w>      </span><span class=nt>&lt;/excludedDestinations&gt;</span>
<span class=w>    </span><span class=nt>&lt;/networkConnector&gt;</span>
<span class=w>    </span><span class=nt>&lt;networkConnector</span><span class=w> </span><span class=na>conduitSubscriptions=</span><span class=s>&quot;false&quot;</span><span class=w> </span><span class=na>consumerTTL=</span><span class=s>&quot;1&quot;</span><span class=w> </span><span class=na>messageTTL=</span><span class=s>&quot;-1&quot;</span><span class=w> </span><span class=na>name=</span><span class=s>&quot;QueueConnector_ConnectingBroker_1_To_3&quot;</span><span class=w> </span><span class=na>uri=</span><span class=s>&quot;masterslave:(ssl://b-ad...647-1.mq.us-west-2.amazonaws.com:61617,ssl://b-ad...d747-2.mq.us-west-2.amazonaws.com:61617)&quot;</span><span class=w> </span><span class=na>userName=</span><span class=s>&quot;mqadmin&quot;</span><span class=nt>&gt;</span>
<span class=w>      </span><span class=nt>&lt;excludedDestinations&gt;</span>
<span class=w>        </span><span class=nt>&lt;topic</span><span class=w> </span><span class=na>physicalName=</span><span class=s>&quot;&amp;gt;&quot;</span><span class=nt>/&gt;</span>
<span class=w>      </span><span class=nt>&lt;/excludedDestinations&gt;</span>
<span class=w>    </span><span class=nt>&lt;/networkConnector&gt;</span>
</code></pre></div> <p>The messages do not flow to other brokers if no consumer is available.</p> <p>The duplex attribute on <code>networkConnector</code> essentially establishes a two-way connection on the same port. This would be useful when network connections are traversing a firewall and is common in <em>Hub and Spoke</em> broker topology. In a Mesh topology, it is recommended to use explicit unidirectional networkConnector as it allows flexibility to include or exclude destinations.</p> <p>Because these brokers are all connected using network connectors, when a producer sends messages to say NoB1, the messages can be consumed from NoB2 or from NoB3.</p> <h3 id=hub-and-spoke>Hub and Spoke<a class=headerlink href=#hub-and-spoke title="Permanent link">&para;</a></h3> <p>For Hub and Spoke a central broker dispatches to other connected broker.</p> <p><img alt src=../diagrams/hub-spoke.drawio.png></p> <p><strong>Figure 4: Hub - spoke topology</strong></p> <h3 id=connection-from-client-app>Connection from client app<a class=headerlink href=#connection-from-client-app title="Permanent link">&para;</a></h3> <p>Once deployed there are 5 differents end points to support the different protocols:</p> <ul> <li>OpenWire – ssl://xxxxxxx.xxx.com:61617</li> <li>AMQP – amqp+ssl:// xxxxxxx.xxx.com:5671</li> <li>STOMP – stomp+ssl:// xxxxxxx.xxx.com:61614</li> <li>MQTT – mqtt+ssl:// xxxxxxx.xxx.com:8883</li> <li>WSS – wss:// xxxxxxx.xxx.com:61619</li> </ul> <p>As of Dec 2023, Amazon MQ doesn't support Mutual Transport Layer Security (mTLS) authentication.</p> <p>In active/standby deployment, any one of the brokers can be active at a time. Any client connecting to a broker uses a failover string that defines each broker that the client can connect to.</p> <div class=highlight><pre><span></span><code>failover:<span class=o>(</span>ssl://b-9f..7ac-1.mq.eu-west-2.amazonaws.com:61617,ssl://b-9f...c-2.mq.eu-west-2.amazonaws.com:61617<span class=o>)</span>
</code></pre></div> <p>Adding failover in broker url ensures that whenever server goes up, it will reconnect it immediately. <a href=https://activemq.apache.org/failover-transport-reference.html>See Active MQ documentation on failover</a></p> <p>When the active broker reboots, the client applications may report issue but reconnect to the backup broker. Below is an example of logs:</p> <div class=highlight><pre><span></span><code>Transport:<span class=w> </span>ssl://b-d....-2.mq.us-west-2.amazonaws.com/10.42.0.113:61617<span class=o>]</span><span class=w> </span>WARN<span class=w> </span>org.apache.activemq.transport.failover.FailoverTransport<span class=w> </span>-<span class=w> </span>Transport<span class=w> </span><span class=o>(</span>ssl://b-d...-2.mq.us-west-2.amazonaws.com:61617<span class=o>)</span><span class=w> </span>failed<span class=w> </span>,<span class=w> </span>attempting<span class=w> </span>to<span class=w> </span>automatically<span class=w> </span>reconnect:<span class=w> </span><span class=o>{}</span>
java.io.EOFException
<span class=w>        </span>at<span class=w> </span>java.base/java.io.DataInputStream.readInt<span class=o>(</span>DataInputStream.java:397<span class=o>)</span>
<span class=w>    </span>...

<span class=o>[</span>ActiveMQ<span class=w> </span>Task-3<span class=o>]</span><span class=w> </span>INFO<span class=w> </span>org.apache.activemq.transport.failover.FailoverTransport<span class=w> </span>-<span class=w> </span>Successfully<span class=w> </span>reconnected<span class=w> </span>to<span class=w> </span>ssl://b-d...-1.mq.us-west-2.amazonaws.com:61617
</code></pre></div> <p>In the context of cluster mesh, each application may use different failover URL to connect to different brokers.</p> <p>One sender can have the following URL configuration:</p> <div class=highlight><pre><span></span><code>failover:<span class=o>(</span>ssl://b-650....e-1.mq.us-west-2.amazonaws.com:61617,ssl://b-650...e-2.mq.us-west-2.amazonaws.com:61617<span class=o>)</span>
</code></pre></div> <p>and one consumer with the url:</p> <div class=highlight><pre><span></span><code>failover:<span class=o>(</span>ssl://b-9f69...f-1.mq.us-west-2.amazonaws.com:61617,ssl://b-9f69...f-2.mq.us-west-2.amazonaws.com:61617<span class=o>)</span>
</code></pre></div> <p>The networkConnector in each broker configuration links each broker per pair, and messages flow between brokers using <code>networkConnectors</code> only when a consumer demands them. The messages do not flow to other brokers if no consumer is available.</p> <h2 id=storage>Storage<a class=headerlink href=#storage title="Permanent link">&para;</a></h2> <p>The <a href=https://activemq.apache.org/amq-message-store>ActiveMQ message storage</a> is an embeddable transactional message storage solution. It uses a transaction journal to support recovery. Messages are persisted in data logs (up to 32mb size) with reference to file location saved in <a href=https://activemq.apache.org/kahadb.html>KahaDB</a>, in memory. Messages are in memory and then periodically inserted in the storage in the frequency of <code>checkpointInterval</code> ms. Version 5.14.0 introduces journal synch to disk strategy: <code>always</code> ensures every journal write is followed by a disk sync (JMS durability requirement). </p> <p>Message data logs includes messages/acks and transactional boundaries. Be sure to have the individual file size greater than the expected largest message size.</p> <p>Also broker who starts to have memory issue, will throttle the producer or even block it. See <a href=https://activemq.apache.org/producer-flow-control.html>this Producer flow control article</a> for deeper explanation and configuration per queue.</p> <p>Messages can be archived into separate logs.</p> <p>See <a href=https://activemq.apache.org/amq-message-store>the product documentation for persistence configuration.</a></p> <h2 id=faqs>FAQs<a class=headerlink href=#faqs title="Permanent link">&para;</a></h2> <details class="- question"> <summary>How to create queue or resources?</summary> <p>With open source Active MQ, we can use JMS API as they can be created dynamically via code, or use JMX. Static definitions can be done in the broker.xml file:</p> <div class=highlight><pre><span></span><code>
</code></pre></div> </details> <details class="- question"> <summary>What is the advantage of replicas vs shared storage?</summary> <p>Shared storage needs to get SAN replication to ensure DR at the storage level. If not the broker file system is a single point of failure. It adds cost to the solution but it performs better. Replicas is ActiveMQ integrate solution to ensure High availability and sharing data between brokers. Slave broker copies data from Master. States of the brokers are not exchanged with replicas, only messages are. For Classic, JDBC message store could be used. Database replication is then used for DR. When non durable queue or topic are networked, with failure, inflight messages may be lost.</p> </details> <details class="- question"> <summary>What is the difference between URL failover and implementing an ExceptionListener?</summary> <p>Java Messaging Service has no specification on failover for JMS provider. When broker fails, there will be a connection Exception. The way to manage this exception is to use the asynchronous <code>ExceptionListener</code> interface which will give developer maximum control over when to reconnect, assessing what type of JMS error to better act on the error. ActiveMQ offers the failover transport protocol, is for connection failure, and let the client app to reconnect to another broker as part of the URL declaration. Sending message to the broker will be blocked until the connection is restored. Use <code>TransportListener</code> interface to understand what is happening. This is a good way to add logging to the application to report on the connection state.</p> </details> <details class="- question"> <summary>When messages are moved to DLQ?</summary> <p>Producer app can set <code>setTimeToLive</code> with millisecond parameter. When the message has not being delivered to consumer, ActiveMQ move it to an expiry address, which could be mapped to a dead-letter queue. In fact a TTL set on a producer, will make ActiveMQ creating an <code>ActiveMQ.DLQ</code> queue. It is recommended to setup a DLQ per queue or per pair of request/response queues. ActiveMQ will <em>never</em> expire messages sent to the DLQ. See <a href=https://activemq.apache.org/message-redelivery-and-dlq-handling.html>product documentation</a></p> <p><div class=highlight><pre><span></span><code><span class=nt>&lt;policyEntry</span><span class=w> </span><span class=na>queue=</span><span class=s>&quot;order*&quot;</span><span class=nt>&gt;</span>
<span class=w>    </span><span class=nt>&lt;deadLetterStrategy&gt;</span>
<span class=w>        </span><span class=nt>&lt;individualDeadLetterStrategy</span><span class=w> </span><span class=na>queuePrefix=</span><span class=s>&quot;DLQ.&quot;</span><span class=w> </span><span class=na>useQueueForQueueMessages=</span><span class=s>&quot;true&quot;</span><span class=nt>/&gt;</span>
<span class=w>    </span><span class=nt>&lt;/deadLetterStrategy&gt;</span>
<span class=nt>&lt;/policyEntry&gt;</span>
</code></pre></div> Use the <code>&lt;deadLetterStrategy&gt; &lt;sharedDeadLetterStrategy processExpired="false" /&gt;</code> to disable DLQ processing.</p> </details> <details class="- question"> <summary>What is the constantPendingMessageLimitStrategy parameter?</summary> <p>When consumers are slow to process message from topic, and the broker is not persisting message, then messages in the RAM will impact consumer and producer performance. This parameter specifies how many messages to keep and let old messages being replace by new ones. See <a href=http://activemq.apache.org/slow-consumer-handling.html>slow consumer section</a> of the product documentation.</p> </details> <details class="- question"> <summary>Broker clustering</summary> <p>Brokers in a cluster can share the message processing, each broker manages its own storage and connections. A core bridge is automatically created. When message arrives it will be send to one of the broker in a round-robin fashion. It can also distribute to brokers that have active consumers. There are different topologies supported: symmetric cluster where all nodes are connected to each other, or chain cluster where node is connected to two neighbores, . With a symmetric cluster each node knows about all the queues that exist on all the other nodes and what consumers they have.</p> </details> <details class="- question"> <summary>Configuring Transport</summary> <p><strong>Acceptor</strong> defines a way in which connections can be made to ActiveMQ broker. Here is one example: <div class=highlight><pre><span></span><code><span class=w>  </span><span class=nt>&lt;acceptor</span><span class=w> </span><span class=na>name=</span><span class=s>&quot;artemis&quot;</span><span class=nt>&gt;</span>tcp://172.19.0.2:61616?tcpSendBufferSize=1048576;tcpReceiveBufferSize=1048576;amqpMinLargeMessageSize=102400;protocols=CORE,AMQP,STOMP,HORNETQ,MQTT,OPENWIRE;useEpoll=true;amqpCredits=1000;amqpLowCredits=300;amqpDuplicateDetection=true;supportAdvisory=false;suppressInternalManagementObjects=false<span class=nt>&lt;/acceptor&gt;</span>
</code></pre></div> <strong>Connectors</strong> define how to connect to the brokers, used when brokers are in cluster or bridged. When a client app, using ClientSessionFactory, uses indirectly connector.</p> </details> <details class="- question"> <summary>What are the metrics to assess to decide to move to server mesh topology?</summary> <p>Server mesh is used to increase the number of consumers by adding brokers that may replicate messages. Broker's memory usage. Looking at the number of messages a specific consumer has acknowledged (inflight). Number of consumer per queue. Other important metrics are looking at <a href=https://activemq.apache.org/components/artemis/documentation/1.0.0/queue-attributes.html>queue attributes</a> like size, DLQ content.</p> </details> <details class="- question"> <summary>How to be quickly aware of broker is rebooting?</summary> <p>Create a CloudWatch alert on the EC2 rebooting event.</p> </details> <details class="- question"> <summary>Why using Jolokia with Active MQ?</summary> <p>Some key reasons why developers use Jolokia for ActiveMQ:</p> <ul> <li>Jolokia allows easy monitoring and management of ActiveMQ brokers and queues/topics via HTTP/JSON. This is more convenient than JMX remoting.</li> <li>It provides remote access to JMX beans without the need to configure JMX ports/SSL etc.</li> <li>Jolokia converts JMX operations to JSON over HTTP. </li> <li>It allows bulk JMX operations to be performed with a single request. This improves performance compared to remote JMX.</li> <li>It can auto-discover brokers and provide an aggregated view of multiple ActiveMQ instances.</li> <li>There are Jolokia client libraries and tools available for Java, JavaScript, Go etc which simplify working with ActiveMQ via Jolokia.</li> <li>Jolokia is not tied to ActiveMQ specifically and can work across different JMX-enabled applications. This makes it reusable.</li> <li>Amazon MQ does not support Jolokia.</li> </ul> </details> <h2 id=code-samples>Code samples<a class=headerlink href=#code-samples title="Permanent link">&para;</a></h2> <ul> <li><a href=../labs/ow-pt-to-pt-jms/ >Point to point producer to consumer using JMS</a> running locally to start playing with Active MQ classic, or deploy the two apps and the Broker on Amazon MQ with AWS CDK as infrastructure as code.</li> </ul> <h2 id=to-address-in-the-future>To address in the future<a class=headerlink href=#to-address-in-the-future title="Permanent link">&para;</a></h2> <ul> <li>amqp client </li> <li>reactive messaging with brocker as channel</li> <li>stomp client</li> <li>openwire client</li> </ul> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=.. class="md-footer__link md-footer__link--prev" aria-label="Previous: Introduction"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> Introduction </div> </div> </a> <a href=../amazonmq/ class="md-footer__link md-footer__link--next" aria-label="Next: Amazon MQ"> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> Amazon MQ </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "..", "features": ["content.code.annotate", "content.tooltips", "navigation.instant", "navigation.tracking", "navigation.footer", "navigation.tabs.sticky"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../assets/javascripts/bundle.ad660dcc.min.js></script> </body> </html>
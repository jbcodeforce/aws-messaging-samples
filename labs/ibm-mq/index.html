<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Jerome Boyer"><link href=../../req-reply-jms/ rel=prev><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.0, mkdocs-material-9.5.27"><title>IBM MQ labs - AWS Messaging Studies</title><link rel=stylesheet href=../../assets/stylesheets/main.6543a935.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../extra.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#ibm-mq-labs class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="AWS Messaging Studies" class="md-header__button md-logo" aria-label="AWS Messaging Studies" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> AWS Messaging Studies </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> IBM MQ labs </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/jbcodeforce/aws-messaging-study.git title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="AWS Messaging Studies" class="md-nav__button md-logo" aria-label="AWS Messaging Studies" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> AWS Messaging Studies </label> <div class=md-nav__source> <a href=https://github.com/jbcodeforce/aws-messaging-study.git title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Introduction </span> </a> </li> <li class=md-nav__item> <a href=../../activemq/ class=md-nav__link> <span class=md-ellipsis> Active MQ </span> </a> </li> <li class=md-nav__item> <a href=../../amazonmq/ class=md-nav__link> <span class=md-ellipsis> Amazon MQ </span> </a> </li> <li class=md-nav__item> <a href=../../sqs/ class=md-nav__link> <span class=md-ellipsis> Amazon SQS </span> </a> </li> <li class=md-nav__item> <a href=../../sns/ class=md-nav__link> <span class=md-ellipsis> Amazon SNS </span> </a> </li> <li class=md-nav__item> <a href=../../rabbitmq/ class=md-nav__link> <span class=md-ellipsis> Rabbit MQ </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7 checked> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex=0> <span class=md-ellipsis> Labs </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=true> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Labs </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_1> <label class=md-nav__link for=__nav_7_1 id=__nav_7_1_label tabindex=0> <span class=md-ellipsis> Active MQ </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_1_label aria-expanded=false> <label class=md-nav__title for=__nav_7_1> <span class="md-nav__icon md-icon"></span> Active MQ </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../aq-aws-console-lab/ class=md-nav__link> <span class=md-ellipsis> Via AWS Console </span> </a> </li> <li class=md-nav__item> <a href=../activemq-monitoring/ class=md-nav__link> <span class=md-ellipsis> ActiveMQ monitoring </span> </a> </li> <li class=md-nav__item> <a href=../activemq-ldap-sec/ class=md-nav__link> <span class=md-ellipsis> Active MQ security </span> </a> </li> <li class=md-nav__item> <a href=../ow-pt-to-pt-jms/ class=md-nav__link> <span class=md-ellipsis> One way pt-to-pt JMS </span> </a> </li> <li class=md-nav__item> <a href=../activemq-cdk/ class=md-nav__link> <span class=md-ellipsis> ActiveMQ with CDK </span> </a> </li> <li class=md-nav__item> <a href=../failover-lab/ class=md-nav__link> <span class=md-ellipsis> Failover to standby </span> </a> </li> <li class=md-nav__item> <a href=../classic-req-reply-jms/ class=md-nav__link> <span class=md-ellipsis> JMS Req-ReplyTo </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_2> <label class=md-nav__link for=__nav_7_2 id=__nav_7_2_label tabindex=0> <span class=md-ellipsis> SQS </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_2_label aria-expanded=false> <label class=md-nav__title for=__nav_7_2> <span class="md-nav__icon md-icon"></span> SQS </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../sqs/ class=md-nav__link> <span class=md-ellipsis> Basic </span> </a> </li> <li class=md-nav__item> <a href=../sqs/s3-tenants-async-processing/ class=md-nav__link> <span class=md-ellipsis> S3-multi-tenant-event </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../req-reply-jms/ class=md-nav__link> <span class=md-ellipsis> Artemis JMS Req-ReplyTo </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> IBM MQ labs </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> IBM MQ labs </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#create-a-ibm-mq-docker-image-for-mac-silicon class=md-nav__link> <span class=md-ellipsis> Create a IBM MQ docker image for Mac silicon </span> </a> </li> <li class=md-nav__item> <a href=#one-way-point-to-point-code-based-on-jms class=md-nav__link> <span class=md-ellipsis> One-way point-to-point code based on JMS </span> </a> <nav class=md-nav aria-label="One-way point-to-point code based on JMS"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#developing-the-jms-producer class=md-nav__link> <span class=md-ellipsis> Developing the JMS producer </span> </a> </li> <li class=md-nav__item> <a href=#developing-the-jms-consumer class=md-nav__link> <span class=md-ellipsis> Developing the JMS consumer </span> </a> </li> <li class=md-nav__item> <a href=#local-ibm-mq-docker-end-to-end-demo class=md-nav__link> <span class=md-ellipsis> Local IBM MQ docker end-to-end demo </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#aws-deployment class=md-nav__link> <span class=md-ellipsis> AWS deployment </span> </a> <nav class=md-nav aria-label="AWS deployment"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#installing-docker-on-one-ec2-instance class=md-nav__link> <span class=md-ellipsis> Installing docker on one EC2 instance </span> </a> </li> <li class=md-nav__item> <a href=#installing-ibm-mq-docker-image-on-ec2 class=md-nav__link> <span class=md-ellipsis> Installing IBM MQ docker image on EC2 </span> </a> </li> <li class=md-nav__item> <a href=#deployment-the-apps-in-ecs-fargate class=md-nav__link> <span class=md-ellipsis> Deployment the apps in ECS Fargate </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#solution-cdk-deployment class=md-nav__link> <span class=md-ellipsis> Solution CDK deployment </span> </a> <nav class=md-nav aria-label="Solution CDK deployment"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#logging class=md-nav__link> <span class=md-ellipsis> Logging </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#useful-source-of-information class=md-nav__link> <span class=md-ellipsis> Useful source of information </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#create-a-ibm-mq-docker-image-for-mac-silicon class=md-nav__link> <span class=md-ellipsis> Create a IBM MQ docker image for Mac silicon </span> </a> </li> <li class=md-nav__item> <a href=#one-way-point-to-point-code-based-on-jms class=md-nav__link> <span class=md-ellipsis> One-way point-to-point code based on JMS </span> </a> <nav class=md-nav aria-label="One-way point-to-point code based on JMS"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#developing-the-jms-producer class=md-nav__link> <span class=md-ellipsis> Developing the JMS producer </span> </a> </li> <li class=md-nav__item> <a href=#developing-the-jms-consumer class=md-nav__link> <span class=md-ellipsis> Developing the JMS consumer </span> </a> </li> <li class=md-nav__item> <a href=#local-ibm-mq-docker-end-to-end-demo class=md-nav__link> <span class=md-ellipsis> Local IBM MQ docker end-to-end demo </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#aws-deployment class=md-nav__link> <span class=md-ellipsis> AWS deployment </span> </a> <nav class=md-nav aria-label="AWS deployment"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#installing-docker-on-one-ec2-instance class=md-nav__link> <span class=md-ellipsis> Installing docker on one EC2 instance </span> </a> </li> <li class=md-nav__item> <a href=#installing-ibm-mq-docker-image-on-ec2 class=md-nav__link> <span class=md-ellipsis> Installing IBM MQ docker image on EC2 </span> </a> </li> <li class=md-nav__item> <a href=#deployment-the-apps-in-ecs-fargate class=md-nav__link> <span class=md-ellipsis> Deployment the apps in ECS Fargate </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#solution-cdk-deployment class=md-nav__link> <span class=md-ellipsis> Solution CDK deployment </span> </a> <nav class=md-nav aria-label="Solution CDK deployment"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#logging class=md-nav__link> <span class=md-ellipsis> Logging </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#useful-source-of-information class=md-nav__link> <span class=md-ellipsis> Useful source of information </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=ibm-mq-labs>IBM MQ Labs<a class=headerlink href=#ibm-mq-labs title="Permanent link">&para;</a></h1> <p>This note regroups explanations of the different code samples to run on top of IBM MQ.</p> <h2 id=create-a-ibm-mq-docker-image-for-mac-silicon>Create a IBM MQ docker image for Mac silicon<a class=headerlink href=#create-a-ibm-mq-docker-image-for-mac-silicon title="Permanent link">&para;</a></h2> <p>With MAC M silicon, we need a different docker image, the information to build such image is in <a href=https://github.com/ibm-messaging/mq-container.git>this repository</a>, but it is simple, once the repository cloned do: <code>make build-devserver</code>. The created docker image on 11/22/2023 is <code>ibm-mqadvanced-server-dev:9.3.4.0-arm64</code>.</p> <p>The docker compose file in <a href=https://github.com/jbcodeforce/aws-messaging-study/blob/main/ibm-mq/src/dev-dc.yaml>docker-compose for ibm mq</a> can start one instance of IBM MQ broker to be used for development purpose.</p> <h2 id=one-way-point-to-point-code-based-on-jms>One-way point-to-point code based on JMS<a class=headerlink href=#one-way-point-to-point-code-based-on-jms title="Permanent link">&para;</a></h2> <p>For the first demonstration we take a simple JMS producer to send message to IBM MQ queue, <code>DEV.QUEUE.1</code>, consumed by a JMS Consumer App. It is a one-way integration pattern with a point-to-point channel using queue. Nothing fancy, but interesting to see the change to the configuration to work with MQ. Here is the simple diagram:</p> <p><img alt src=../diagrams/p2p-mq-jms.drawio.png></p> <h3 id=developing-the-jms-producer>Developing the JMS producer<a class=headerlink href=#developing-the-jms-producer title="Permanent link">&para;</a></h3> <ul> <li>Under <a href=https://github.com/jbcodeforce/aws-messaging-study/tree/main/ibm-mq/src/pt-to-pt-jms>pt-to-pt-jms</a> folder, start one IBM MQ Broker with docker: <code>docker-compose -f dev-dc.yaml up -d</code></li> <li>Under <code>jms-producer</code> folder, use <code>quarkus dev</code> to test the app.</li> </ul> <p>Some important notes:</p> <ul> <li>The IBM MQ docker in dev mode (set by environment variable: <code>MQ_DEV: true</code> in docker compose file), has the following predefined MQ objects: <code>DEV.QUEUE.1</code>, <code>DEV.QUEUE.2</code>, <code>DEV.QUEUE.3</code>, <code>DEV.DEAD.LETTER.QUEUE</code> and the <code>DEV.APP.SVRCONN</code> and <code>DEV.ADMIN.SVRCONN</code> channel. We can use this channel and one of the queue for the demonstration.</li> <li>In the docker compose file, the fact that we configure the env variable <code>MQ_APP_PASSWORD</code> with a password means we need to do the same for the application.</li> <li>The <code>application.properties</code> file for the quarkus app defines user and password to be used to connect, as well as the channel and the queue name:</li> </ul> <div class=highlight><pre><span></span><code>mq.host<span class=o>=</span>localhost
mq.port<span class=o>=</span><span class=m>1414</span>
mq.channel<span class=o>=</span>DEV.APP.SVRCONN
mq.qmgr<span class=o>=</span>QM1
mq.app_user<span class=o>=</span>app
mq.app_password<span class=o>=</span>passw0rd
mq.queue_name<span class=o>=</span>DEV.QUEUE.1
</code></pre></div> <ul> <li>The connection code has some small modifications as summarized below:</li> </ul> <div class=highlight><pre><span></span><code><span class=n>JmsFactoryFactory</span><span class=w> </span><span class=n>ff</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>JmsFactoryFactory</span><span class=p>.</span><span class=na>getInstance</span><span class=p>(</span><span class=n>WMQConstants</span><span class=p>.</span><span class=na>WMQ_PROVIDER</span><span class=p>);</span>
<span class=n>connectionFactory</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ff</span><span class=p>.</span><span class=na>createConnectionFactory</span><span class=p>();</span>
<span class=n>connectionFactory</span><span class=p>.</span><span class=na>setStringProperty</span><span class=p>(</span><span class=n>WMQConstants</span><span class=p>.</span><span class=na>WMQ_HOST_NAME</span><span class=p>,</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=na>mqHostname</span><span class=p>);</span>
<span class=n>connectionFactory</span><span class=p>.</span><span class=na>setIntProperty</span><span class=p>(</span><span class=n>WMQConstants</span><span class=p>.</span><span class=na>WMQ_PORT</span><span class=p>,</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=na>mqHostport</span><span class=p>);</span>
<span class=n>connectionFactory</span><span class=p>.</span><span class=na>setStringProperty</span><span class=p>(</span><span class=n>WMQConstants</span><span class=p>.</span><span class=na>WMQ_CHANNEL</span><span class=p>,</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=na>mqChannel</span><span class=p>);</span>
<span class=n>connectionFactory</span><span class=p>.</span><span class=na>setIntProperty</span><span class=p>(</span><span class=n>WMQConstants</span><span class=p>.</span><span class=na>WMQ_CONNECTION_MODE</span><span class=p>,</span><span class=w> </span><span class=n>WMQConstants</span><span class=p>.</span><span class=na>WMQ_CM_CLIENT</span><span class=p>);</span>
<span class=n>connectionFactory</span><span class=p>.</span><span class=na>setStringProperty</span><span class=p>(</span><span class=n>WMQConstants</span><span class=p>.</span><span class=na>WMQ_QUEUE_MANAGER</span><span class=p>,</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=na>mqQmgr</span><span class=p>);</span>
<span class=n>connectionFactory</span><span class=p>.</span><span class=na>setStringProperty</span><span class=p>(</span><span class=n>WMQConstants</span><span class=p>.</span><span class=na>WMQ_APPLICATIONNAME</span><span class=p>,</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=na>appName</span><span class=p>);</span>
<span class=n>connectionFactory</span><span class=p>.</span><span class=na>setBooleanProperty</span><span class=p>(</span><span class=n>WMQConstants</span><span class=p>.</span><span class=na>USER_AUTHENTICATION_MQCSP</span><span class=p>,</span><span class=w> </span><span class=kc>false</span><span class=p>);</span>
<span class=n>connectionFactory</span><span class=p>.</span><span class=na>setStringProperty</span><span class=p>(</span><span class=n>WMQConstants</span><span class=p>.</span><span class=na>USERID</span><span class=p>,</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=na>mqAppUser</span><span class=p>);</span>
<span class=n>connectionFactory</span><span class=p>.</span><span class=na>setStringProperty</span><span class=p>(</span><span class=n>WMQConstants</span><span class=p>.</span><span class=na>PASSWORD</span><span class=p>,</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=na>mqPassword</span><span class=p>);</span>
</code></pre></div> <p>be sure to add IBM MQ dependency in the pom.xml</p> <div class=highlight><pre><span></span><code><span class=w>  </span><span class=nt>&lt;dependency&gt;</span>
<span class=w>    </span><span class=nt>&lt;groupId&gt;</span>com.ibm.mq<span class=nt>&lt;/groupId&gt;</span>
<span class=w>    </span><span class=nt>&lt;artifactId&gt;</span>com.ibm.mq.allclient<span class=nt>&lt;/artifactId&gt;</span>
<span class=w>    </span><span class=nt>&lt;version&gt;</span>9.3.4.0<span class=nt>&lt;/version&gt;</span>
<span class=w>  </span><span class=nt>&lt;/dependency&gt;</span>
</code></pre></div> <p>We will see CCDT parameters later.</p> <ul> <li>Once the app runs, it should be connected with logs showing:</li> </ul> <div class=highlight><pre><span></span><code><span class=mi>18</span><span class=p>:</span><span class=mi>41</span><span class=p>:</span><span class=mi>36</span><span class=w> </span><span class=n>INFO</span><span class=w>  </span><span class=o>[</span><span class=n>or</span><span class=p>.</span><span class=na>ac</span><span class=p>.</span><span class=na>jm</span><span class=p>.</span><span class=na>ProductQuoteProducer</span><span class=o>]</span><span class=w> </span><span class=p>(</span><span class=n>Quarkus</span><span class=w> </span><span class=n>Main</span><span class=w> </span><span class=n>Thread</span><span class=p>)</span><span class=w> </span><span class=n>Hostname</span><span class=p>:</span><span class=w> </span><span class=n>localhost</span>
<span class=mi>18</span><span class=p>:</span><span class=mi>41</span><span class=p>:</span><span class=mi>36</span><span class=w> </span><span class=n>INFO</span><span class=w>  </span><span class=o>[</span><span class=n>or</span><span class=p>.</span><span class=na>ac</span><span class=p>.</span><span class=na>jm</span><span class=p>.</span><span class=na>ProductQuoteProducer</span><span class=o>]</span><span class=w> </span><span class=p>(</span><span class=n>Quarkus</span><span class=w> </span><span class=n>Main</span><span class=w> </span><span class=n>Thread</span><span class=p>)</span><span class=w> </span><span class=n>Port</span><span class=p>:</span><span class=w> </span><span class=mi>1414</span>
<span class=mi>18</span><span class=p>:</span><span class=mi>41</span><span class=p>:</span><span class=mi>36</span><span class=w> </span><span class=n>INFO</span><span class=w>  </span><span class=o>[</span><span class=n>or</span><span class=p>.</span><span class=na>ac</span><span class=p>.</span><span class=na>jm</span><span class=p>.</span><span class=na>ProductQuoteProducer</span><span class=o>]</span><span class=w> </span><span class=p>(</span><span class=n>Quarkus</span><span class=w> </span><span class=n>Main</span><span class=w> </span><span class=n>Thread</span><span class=p>)</span><span class=w> </span><span class=n>Channel</span><span class=p>:</span><span class=w> </span><span class=n>DEV</span><span class=p>.</span><span class=na>APP</span><span class=p>.</span><span class=na>SVRCONN</span>
<span class=mi>18</span><span class=p>:</span><span class=mi>41</span><span class=p>:</span><span class=mi>36</span><span class=w> </span><span class=n>INFO</span><span class=w>  </span><span class=o>[</span><span class=n>or</span><span class=p>.</span><span class=na>ac</span><span class=p>.</span><span class=na>jm</span><span class=p>.</span><span class=na>ProductQuoteProducer</span><span class=o>]</span><span class=w> </span><span class=p>(</span><span class=n>Quarkus</span><span class=w> </span><span class=n>Main</span><span class=w> </span><span class=n>Thread</span><span class=p>)</span><span class=w> </span><span class=n>Qmgr</span><span class=p>:</span><span class=w> </span><span class=n>QM1</span>
<span class=mi>18</span><span class=p>:</span><span class=mi>41</span><span class=p>:</span><span class=mi>36</span><span class=w> </span><span class=n>INFO</span><span class=w>  </span><span class=o>[</span><span class=n>or</span><span class=p>.</span><span class=na>ac</span><span class=p>.</span><span class=na>jm</span><span class=p>.</span><span class=na>ProductQuoteProducer</span><span class=o>]</span><span class=w> </span><span class=p>(</span><span class=n>Quarkus</span><span class=w> </span><span class=n>Main</span><span class=w> </span><span class=n>Thread</span><span class=p>)</span><span class=w> </span><span class=n>App</span><span class=w> </span><span class=n>User</span><span class=p>:</span><span class=w> </span><span class=n>app</span>
<span class=mi>18</span><span class=p>:</span><span class=mi>41</span><span class=p>:</span><span class=mi>36</span><span class=w> </span><span class=n>INFO</span><span class=w>  </span><span class=o>[</span><span class=n>or</span><span class=p>.</span><span class=na>ac</span><span class=p>.</span><span class=na>jm</span><span class=p>.</span><span class=na>ProductQuoteProducer</span><span class=o>]</span><span class=w> </span><span class=p>(</span><span class=n>Quarkus</span><span class=w> </span><span class=n>Main</span><span class=w> </span><span class=n>Thread</span><span class=p>)</span><span class=w> </span><span class=n>No</span><span class=w> </span><span class=n>valid</span><span class=w> </span><span class=n>CCDT</span><span class=w> </span><span class=n>file</span><span class=w> </span><span class=n>detected</span><span class=p>.</span><span class=w> </span><span class=n>Using</span><span class=w> </span><span class=n>host</span><span class=p>,</span><span class=w> </span><span class=n>port</span><span class=p>,</span><span class=w> </span><span class=n>and</span><span class=w> </span><span class=n>channel</span><span class=w> </span><span class=n>properties</span><span class=w> </span><span class=n>instead</span><span class=p>.</span>
<span class=mi>18</span><span class=p>:</span><span class=mi>41</span><span class=p>:</span><span class=mi>36</span><span class=w> </span><span class=n>INFO</span><span class=w>  </span><span class=o>[</span><span class=n>or</span><span class=p>.</span><span class=na>ac</span><span class=p>.</span><span class=na>jm</span><span class=p>.</span><span class=na>ProductQuoteProducer</span><span class=o>]</span><span class=w> </span><span class=p>(</span><span class=n>Quarkus</span><span class=w> </span><span class=n>Main</span><span class=w> </span><span class=n>Thread</span><span class=p>)</span><span class=w> </span><span class=n>Connect</span><span class=w> </span><span class=n>to</span><span class=w> </span><span class=n>broker</span><span class=w> </span><span class=n>succeed</span>
<span class=mi>18</span><span class=p>:</span><span class=mi>41</span><span class=p>:</span><span class=mi>36</span><span class=w> </span><span class=n>INFO</span><span class=w>  </span><span class=o>[</span><span class=n>or</span><span class=p>.</span><span class=na>ac</span><span class=p>.</span><span class=na>jm</span><span class=p>.</span><span class=na>ProductQuoteProducer</span><span class=o>]</span><span class=w> </span><span class=p>(</span><span class=n>Quarkus</span><span class=w> </span><span class=n>Main</span><span class=w> </span><span class=n>Thread</span><span class=p>)</span><span class=w> </span><span class=n>JMS</span><span class=w> </span><span class=n>Producer</span><span class=w> </span><span class=n>Started</span>
</code></pre></div> <ul> <li>In the IBM MQ we can see the running channel and the connected application</li> </ul> <p><img alt src=../images/mq-channel-running.png></p> <ul> <li>Posting to the simul REST end point will generate 10 messages:</li> </ul> <div class=highlight><pre><span></span><code>curl<span class=w> </span>-X<span class=w> </span><span class=s1>&#39;POST&#39;</span><span class=w> </span><span class=se>\</span>
<span class=s1>&#39;http://localhost:8081/simulator&#39;</span><span class=w> </span><span class=se>\</span>
-H<span class=w> </span><span class=s1>&#39;accept: application/json&#39;</span><span class=w> </span><span class=se>\</span>
-H<span class=w> </span><span class=s1>&#39;Content-Type: application/json&#39;</span><span class=w> </span><span class=se>\</span>
-d<span class=w> </span><span class=s1>&#39;{</span>
<span class=s1>&quot;delay&quot;: 0,</span>
<span class=s1>&quot;totalMessageToSend&quot;: 10</span>
<span class=s1>}&#39;</span>
</code></pre></div> <ul> <li>The messages are in the queue</li> </ul> <p><img alt src=../images/mq-dev-queue-1.png></p> <h3 id=developing-the-jms-consumer>Developing the JMS consumer<a class=headerlink href=#developing-the-jms-consumer title="Permanent link">&para;</a></h3> <p>This time the code is in <a href=https://github.com/jbcodeforce/aws-messaging-study/tree/main/ibm-mq/src/pt-to-pt-jms/jms-consumer>pt-to-pt-jms/jms-consumer</a>. The classical JMS MessageListener implementation with the same code to initiate connection to the server. The code is using Jackson mapper for Json to Java Object for the Quote.</p> <p>The code supports reconnection on exception with some delay to try to reconnect.</p> <h3 id=local-ibm-mq-docker-end-to-end-demo>Local IBM MQ docker end-to-end demo<a class=headerlink href=#local-ibm-mq-docker-end-to-end-demo title="Permanent link">&para;</a></h3> <ol> <li>Be sure to build the producer and consumer docker images with <code>./buildAll.sh</code> under <code>pt-to-pt-jms</code> folder.</li> <li>Under <code>pt-to-pt-jms</code> start docker compose with one IBM MQ broker: <code>docker-compose up</code>. The trace should demonstrate that IBM MQ will take a little bit more time than the two quarkus apps to start, but those apps are able to reconnect, as they retries every 5 seconds to reconnect to the brokers.</li> <li>Connect to the Console at <a href=https://localhost:9443>https://localhost:9443</a>, accept the risk on the non-CA certificate, and use admin/passw0rd to access the console.</li> <li>Connect to the Consumer web page to see the last quote: <a href=http://localhost:8080>http://localhost:8080</a></li> <li>Connect to the Producer swagger UI: <a href=http://localhost:8081/q/swagger-ui>http://localhost:8081/q/swagger-ui</a> and start a simulation with 20 records. The trace should list the message produces and consumes.</li> </ol> <div class=highlight><pre><span></span><code><span class=n>consumer</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mo>05</span><span class=p>:</span><span class=mi>21</span><span class=p>:</span><span class=mi>43</span><span class=w> </span><span class=n>INFO</span><span class=w>  </span><span class=o>[</span><span class=n>or</span><span class=p>.</span><span class=na>ac</span><span class=p>.</span><span class=na>jm</span><span class=p>.</span><span class=na>in</span><span class=p>.</span><span class=na>ms</span><span class=p>.</span><span class=na>ProductQuoteConsumer</span><span class=o>]</span><span class=w> </span><span class=p>(</span><span class=n>DispatchThread</span><span class=p>:</span><span class=w> </span><span class=o>[</span><span class=n>com</span><span class=p>.</span><span class=na>ibm</span><span class=p>.</span><span class=na>mq</span><span class=p>.</span><span class=na>jmqi</span><span class=p>.</span><span class=na>remote</span><span class=p>.</span><span class=na>impl</span><span class=p>.</span><span class=na>RemoteSession</span><span class=o>[</span><span class=p>:</span><span class=o>/</span><span class=mi>43</span><span class=n>f01614</span><span class=o>][</span><span class=n>connectionId</span><span class=o>=</span><span class=mi>414</span><span class=n>D5143514D312020202020202020209A1B686500310040</span><span class=p>,</span><span class=n>traceIdentifier</span><span class=o>=</span><span class=mi>5</span><span class=p>,</span><span class=n>remoteTraceIdentifier</span><span class=o>=</span><span class=mi>8</span><span class=o>]]</span><span class=p>)</span><span class=w> </span><span class=n>Received</span><span class=w> </span><span class=n>message</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=s>&quot;sku&quot;</span><span class=p>:</span><span class=w> </span><span class=n>sku8</span><span class=p>,</span><span class=s>&quot;quote&quot;</span><span class=p>:</span><span class=w> </span><span class=mi>83</span><span class=w> </span><span class=p>}</span>
<span class=n>producer</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mo>05</span><span class=p>:</span><span class=mi>21</span><span class=p>:</span><span class=mi>43</span><span class=w> </span><span class=n>INFO</span><span class=w>  </span><span class=o>[</span><span class=n>or</span><span class=p>.</span><span class=na>ac</span><span class=p>.</span><span class=na>jm</span><span class=p>.</span><span class=na>in</span><span class=p>.</span><span class=na>ms</span><span class=p>.</span><span class=na>ProductQuoteProducer</span><span class=o>]</span><span class=w> </span><span class=p>(</span><span class=n>executor</span><span class=o>-</span><span class=n>thread</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=w> </span><span class=n>Sent</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=s>&quot;sku&quot;</span><span class=p>:</span><span class=s>&quot;sku8&quot;</span><span class=p>,</span><span class=s>&quot;quote&quot;</span><span class=p>:</span><span class=mi>83</span><span class=p>}</span>
<span class=n>producer</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mo>05</span><span class=p>:</span><span class=mi>21</span><span class=p>:</span><span class=mi>44</span><span class=w> </span><span class=n>INFO</span><span class=w>  </span><span class=o>[</span><span class=n>or</span><span class=p>.</span><span class=na>ac</span><span class=p>.</span><span class=na>jm</span><span class=p>.</span><span class=na>in</span><span class=p>.</span><span class=na>ms</span><span class=p>.</span><span class=na>ProductQuoteProducer</span><span class=o>]</span><span class=w> </span><span class=p>(</span><span class=n>executor</span><span class=o>-</span><span class=n>thread</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=w> </span><span class=n>Sent</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=s>&quot;sku&quot;</span><span class=p>:</span><span class=s>&quot;sku1&quot;</span><span class=p>,</span><span class=s>&quot;quote&quot;</span><span class=p>:</span><span class=mi>69</span><span class=p>}</span>
<span class=n>consumer</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mo>05</span><span class=p>:</span><span class=mi>21</span><span class=p>:</span><span class=mi>44</span><span class=w> </span><span class=n>INFO</span><span class=w>  </span><span class=o>[</span><span class=n>or</span><span class=p>.</span><span class=na>ac</span><span class=p>.</span><span class=na>jm</span><span class=p>.</span><span class=na>in</span><span class=p>.</span><span class=na>ms</span><span class=p>.</span><span class=na>ProductQuoteConsumer</span><span class=o>]</span><span class=w> </span><span class=p>(</span><span class=n>DispatchThread</span><span class=p>:</span><span class=w> </span><span class=o>[</span><span class=n>com</span><span class=p>.</span><span class=na>ibm</span><span class=p>.</span><span class=na>mq</span><span class=p>.</span><span class=na>jmqi</span><span class=p>.</span><span class=na>remote</span><span class=p>.</span><span class=na>impl</span><span class=p>.</span><span class=na>RemoteSession</span><span class=o>[</span><span class=p>:</span><span class=o>/</span><span class=mi>43</span><span class=n>f01614</span><span class=o>][</span><span class=n>connectionId</span><span class=o>=</span><span class=mi>414</span><span class=n>D5143514D312020202020202020209A1B686500310040</span><span class=p>,</span><span class=n>traceIdentifier</span><span class=o>=</span><span class=mi>5</span><span class=p>,</span><span class=n>remoteTraceIdentifier</span><span class=o>=</span><span class=mi>8</span><span class=o>]]</span><span class=p>)</span><span class=w> </span><span class=n>Received</span><span class=w> </span><span class=n>message</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=s>&quot;sku&quot;</span><span class=p>:</span><span class=w> </span><span class=n>sku1</span><span class=p>,</span><span class=s>&quot;quote&quot;</span><span class=p>:</span><span class=w> </span><span class=mi>69</span><span class=w> </span><span class=p>}</span>
<span class=n>producer</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mo>05</span><span class=p>:</span><span class=mi>21</span><span class=p>:</span><span class=mi>44</span><span class=w> </span><span class=n>INFO</span><span class=w>  </span><span class=o>[</span><span class=n>or</span><span class=p>.</span><span class=na>ac</span><span class=p>.</span><span class=na>jm</span><span class=p>.</span><span class=na>in</span><span class=p>.</span><span class=na>ms</span><span class=p>.</span><span class=na>ProductQuoteProducer</span><span class=o>]</span><span class=w> </span><span class=p>(</span><span class=n>executor</span><span class=o>-</span><span class=n>thread</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=w> </span><span class=n>Sent</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=s>&quot;sku&quot;</span><span class=p>:</span><span class=s>&quot;sku7&quot;</span><span class=p>,</span><span class=s>&quot;quote&quot;</span><span class=p>:</span><span class=mi>18</span><span class=p>}</span>
<span class=n>consumer</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mo>05</span><span class=p>:</span><span class=mi>21</span><span class=p>:</span><span class=mi>44</span><span class=w> </span><span class=n>INFO</span><span class=w>  </span><span class=o>[</span><span class=n>or</span><span class=p>.</span><span class=na>ac</span><span class=p>.</span><span class=na>jm</span><span class=p>.</span><span class=na>in</span><span class=p>.</span><span class=na>ms</span><span class=p>.</span><span class=na>ProductQuoteConsumer</span><span class=o>]</span><span class=w> </span><span class=p>(</span><span class=n>DispatchThread</span><span class=p>:</span><span class=w> </span><span class=o>[</span><span class=n>com</span><span class=p>.</span><span class=na>ibm</span><span class=p>.</span><span class=na>mq</span><span class=p>.</span><span class=na>jmqi</span><span class=p>.</span><span class=na>remote</span><span class=p>.</span><span class=na>impl</span><span class=p>.</span><span class=na>RemoteSession</span><span class=o>[</span><span class=p>:</span><span class=o>/</span><span class=mi>43</span><span class=n>f01614</span><span class=o>][</span><span class=n>connectionId</span><span class=o>=</span><span class=mi>414</span><span class=n>D5143514D312020202020202020209A1B686500310040</span><span class=p>,</span><span class=n>traceIdentifier</span><span class=o>=</span><span class=mi>5</span><span class=p>,</span><span class=n>remoteTraceIdentifier</span><span class=o>=</span><span class=mi>8</span><span class=o>]]</span><span class=p>)</span><span class=w> </span><span class=n>Received</span><span class=w> </span><span class=n>message</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=s>&quot;sku&quot;</span><span class=p>:</span><span class=w> </span><span class=n>sku7</span><span class=p>,</span><span class=s>&quot;quote&quot;</span><span class=p>:</span><span class=w> </span><span class=mi>18</span><span class=w> </span><span class=p>}</span>
<span class=n>producer</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mo>05</span><span class=p>:</span><span class=mi>21</span><span class=p>:</span><span class=mi>45</span><span class=w> </span><span class=n>INFO</span><span class=w>  </span><span class=o>[</span><span class=n>or</span><span class=p>.</span><span class=na>ac</span><span class=p>.</span><span class=na>jm</span><span class=p>.</span><span class=na>in</span><span class=p>.</span><span class=na>ms</span><span class=p>.</span><span class=na>ProductQuoteProducer</span><span class=o>]</span><span class=w> </span><span class=p>(</span><span class=n>executor</span><span class=o>-</span><span class=n>thread</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=w> </span><span class=n>Sent</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=s>&quot;sku&quot;</span><span class=p>:</span><span class=s>&quot;sku10&quot;</span><span class=p>,</span><span class=s>&quot;quote&quot;</span><span class=p>:</span><span class=mi>94</span><span class=p>}</span>
<span class=n>consumer</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mo>05</span><span class=p>:</span><span class=mi>21</span><span class=p>:</span><span class=mi>45</span><span class=w> </span><span class=n>INFO</span><span class=w>  </span><span class=o>[</span><span class=n>or</span><span class=p>.</span><span class=na>ac</span><span class=p>.</span><span class=na>jm</span><span class=p>.</span><span class=na>in</span><span class=p>.</span><span class=na>ms</span><span class=p>.</span><span class=na>ProductQuoteConsumer</span><span class=o>]</span><span class=w> </span><span class=p>(</span><span class=n>DispatchThread</span><span class=p>:</span><span class=w> </span><span class=o>[</span><span class=n>com</span><span class=p>.</span><span class=na>ibm</span><span class=p>.</span><span class=na>mq</span><span class=p>.</span><span class=na>jmqi</span><span class=p>.</span><span class=na>remote</span><span class=p>.</span><span class=na>impl</span><span class=p>.</span><span class=na>RemoteSession</span><span class=o>[</span><span class=p>:</span><span class=o>/</span><span class=mi>43</span><span class=n>f01614</span><span class=o>][</span><span class=n>connectionId</span><span class=o>=</span><span class=mi>414</span><span class=n>D5143514D312020202020202020209A1B686500310040</span><span class=p>,</span><span class=n>traceIdentifier</span><span class=o>=</span><span class=mi>5</span><span class=p>,</span><span class=n>remoteTraceIdentifier</span><span class=o>=</span><span class=mi>8</span><span class=o>]]</span><span class=p>)</span><span class=w> </span><span class=n>Received</span><span class=w> </span><span class=n>message</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=s>&quot;sku&quot;</span><span class=p>:</span><span class=w> </span><span class=n>sku10</span><span class=p>,</span><span class=s>&quot;quote&quot;</span><span class=p>:</span><span class=w> </span><span class=mi>94</span><span class=w> </span><span class=p>}</span>
<span class=n>producer</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mo>05</span><span class=p>:</span><span class=mi>21</span><span class=p>:</span><span class=mi>45</span><span class=w> </span><span class=n>INFO</span><span class=w>  </span><span class=o>[</span><span class=n>or</span><span class=p>.</span><span class=na>ac</span><span class=p>.</span><span class=na>jm</span><span class=p>.</span><span class=na>in</span><span class=p>.</span><span class=na>ms</span><span class=p>.</span><span class=na>ProductQuoteProducer</span><span class=o>]</span><span class=w> </span><span class=p>(</span><span class=n>executor</span><span class=o>-</span><span class=n>thread</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=w> </span><span class=n>Sent</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=s>&quot;sku&quot;</span><span class=p>:</span><span class=s>&quot;sku6&quot;</span><span class=p>,</span><span class=s>&quot;quote&quot;</span><span class=p>:</span><span class=mi>59</span><span class=p>}</span>
<span class=n>consumer</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=mo>05</span><span class=p>:</span><span class=mi>21</span><span class=p>:</span><span class=mi>45</span><span class=w> </span><span class=n>INFO</span><span class=w>  </span><span class=o>[</span><span class=n>or</span><span class=p>.</span><span class=na>ac</span><span class=p>.</span><span class=na>jm</span><span class=p>.</span><span class=na>in</span><span class=p>.</span><span class=na>ms</span><span class=p>.</span><span class=na>ProductQuoteConsumer</span><span class=o>]</span><span class=w> </span><span class=p>(</span><span class=n>DispatchThread</span><span class=p>:</span><span class=w> </span><span class=o>[</span><span class=n>com</span><span class=p>.</span><span class=na>ibm</span><span class=p>.</span><span class=na>mq</span><span class=p>.</span><span class=na>jmqi</span><span class=p>.</span><span class=na>remote</span><span class=p>.</span><span class=na>impl</span><span class=p>.</span><span class=na>RemoteSession</span><span class=o>[</span><span class=p>:</span><span class=o>/</span><span class=mi>43</span><span class=n>f01614</span><span class=o>][</span><span class=n>connectionId</span><span class=o>=</span><span class=mi>414</span><span class=n>D5143514D312020202020202020209A1B686500310040</span><span class=p>,</span><span class=n>traceIdentifier</span><span class=o>=</span><span class=mi>5</span><span class=p>,</span><span class=n>remoteTraceIdentifier</span><span class=o>=</span><span class=mi>8</span><span class=o>]]</span><span class=p>)</span><span class=w> </span><span class=n>Received</span><span class=w> </span><span class=n>message</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=s>&quot;sku&quot;</span><span class=p>:</span><span class=w> </span><span class=n>sku6</span><span class=p>,</span><span class=s>&quot;quote&quot;</span><span class=p>:</span><span class=w> </span><span class=mi>59</span><span class=w> </span><span class=p>}</span>
</code></pre></div> <h2 id=aws-deployment>AWS deployment<a class=headerlink href=#aws-deployment title="Permanent link">&para;</a></h2> <p>We can do a manual deployment or using CDK.</p> <h3 id=installing-docker-on-one-ec2-instance>Installing docker on one EC2 instance<a class=headerlink href=#installing-docker-on-one-ec2-instance title="Permanent link">&para;</a></h3> <p>Once creating a t3.micro EC2 instance, SSH to it and then do the following steps:</p> <ul> <li>Install docker, docker compose, start the service, add ec2-user to docker group.</li> </ul> <div class=highlight><pre><span></span><code>sudo<span class=w> </span>yum<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>docker
sudo<span class=w> </span>service<span class=w> </span>docker<span class=w> </span>start
sudo<span class=w> </span>usermod<span class=w> </span>-a<span class=w> </span>-G<span class=w> </span>docker<span class=w> </span>ec2-user
sudo<span class=w> </span>chkconfig<span class=w> </span>docker<span class=w> </span>on
sudo<span class=w> </span>curl<span class=w> </span>-L<span class=w> </span>https://github.com/docker/compose/releases/latest/download/docker-compose-<span class=k>$(</span>uname<span class=w> </span>-s<span class=k>)</span>-<span class=k>$(</span>uname<span class=w> </span>-m<span class=k>)</span><span class=w> </span>-o<span class=w> </span>/usr/local/bin/docker-compose
<span class=w> </span>sudo<span class=w> </span>chmod<span class=w> </span>+x<span class=w> </span>/usr/local/bin/docker-compose
<span class=c1># logout - login back</span>
docker<span class=w> </span>info
docker-compose<span class=w> </span>version
<span class=c1># logout and login again with ec2-user - to avoid the permission denied on docker socket.</span>
docker<span class=w> </span>images<span class=w> </span>
</code></pre></div> <h3 id=installing-ibm-mq-docker-image-on-ec2>Installing IBM MQ docker image on EC2<a class=headerlink href=#installing-ibm-mq-docker-image-on-ec2 title="Permanent link">&para;</a></h3> <ul> <li>The docker image to use on Linux AMI 2023 is: <code>icr.io/ibm-messaging/mq:latest</code>. </li> </ul> <div class=highlight><pre><span></span><code>docker<span class=w> </span>pull<span class=w> </span>icr.io/ibm-messaging/mq:latest
</code></pre></div> <ul> <li>Create a docker compose file to use this image:</li> </ul> <div class=highlight><pre><span></span><code><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s>&#39;3.7&#39;</span>
<span class=nt>services</span><span class=p>:</span>
<span class=w>  </span><span class=nt>ibmmq</span><span class=p>:</span>
<span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">icr.io/ibm-messaging/mq:latest</span>
<span class=w>    </span><span class=nt>docker_name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ibmmq</span>
<span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
<span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&#39;1414:1414&#39;</span>
<span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&#39;9443:9443&#39;</span>
<span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&#39;9157:9157&#39;</span>
<span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
<span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">qm1data:/mnt/mqm</span>
<span class=w>    </span><span class=nt>stdin_open</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class=w>    </span><span class=nt>tty</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class=w>    </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">always</span>
<span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
<span class=w>        </span><span class=nt>LICENSE</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">accept</span>
<span class=w>        </span><span class=nt>MQ_QMGR_NAME</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">QM1</span>
<span class=w>        </span><span class=nt>MQ_ADMIN_PASSWORD</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">passw0rd</span>
<span class=w>        </span><span class=nt>MQ_APP_PASSWORD</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">passw0rd</span>
<span class=w>        </span><span class=nt>MQ_ENABLE_METRICS</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class=w>        </span><span class=nt>MQ_DEV</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class=nt>volumes</span><span class=p>:</span>
<span class=w>  </span><span class=nt>qm1data</span><span class=p>:</span>
</code></pre></div> <ul> <li> <p>Modify the security group of the EC2 instance to add an inbound rule for custom TCP on port 9443, and another one for TCP port 1414.</p> </li> <li> <p>Start the MQ server</p> </li> </ul> <div class=highlight><pre><span></span><code>docker-compose<span class=w> </span>up<span class=w> </span>-d
</code></pre></div> <ul> <li>Access the IBM Console via the EC2 public URL with port 9443, accept the risk, the user is admin user and password.</li> </ul> <h3 id=deployment-the-apps-in-ecs-fargate>Deployment the apps in ECS Fargate<a class=headerlink href=#deployment-the-apps-in-ecs-fargate title="Permanent link">&para;</a></h3> <p>We can upload the two created docker images to ECR, then defines tasks and service.</p> <ol> <li> <p>First build the docker images for each service using <code>buildAll.sh</code> command: Change the name of the image to adapt to your ECR repository.</p> <div class=highlight><pre><span></span><code><span class=nb>cd</span><span class=w> </span>jms-orchestrator
buildAll.sh
docker<span class=w> </span>push<span class=w> </span>toECR_repository
<span class=nb>cd</span><span class=w> </span>jms-participant
buildAll.sh
docker<span class=w> </span>push<span class=w> </span>toECR_repository
</code></pre></div> </li> <li> <p>If not already done, use CDK to deploy VPC, Brokers using <a href=../activemq-cdk/#common-stack>the instructions here</a>.</p> </li> <li>Deploy Active MQ in <a href=../activemq-cdk/#active-mq-activestandby>active/standby architecture</a></li> <li>Use CDK to deploy the two apps on ECS Fargate.</li> </ol> <h2 id=solution-cdk-deployment>Solution CDK deployment<a class=headerlink href=#solution-cdk-deployment title="Permanent link">&para;</a></h2> <p>The CDK approach deploy an EC2 for IBM MQ broker, the two apps in ECS Fargate.</p> <h3 id=logging>Logging<a class=headerlink href=#logging title="Permanent link">&para;</a></h3> <p>https://docs.aws.amazon.com/amazon-mq/latest/developer-guide/security-logging-monitoring-cloudwatch.html https://docs.aws.amazon.com/amazon-mq/latest/developer-guide/amazon-mq-accessing-metrics.html</p> <h2 id=useful-source-of-information>Useful source of information<a class=headerlink href=#useful-source-of-information title="Permanent link">&para;</a></h2> <ul> <li><a href=https://developer.ibm.com/learningpaths/ibm-mq-badge>IBM MQ Developer Essentials</a></li> <li><a href=https://developer.ibm.com/articles/mq-dev-cheat-sheet/ >MQ Developer Cheat sheet:</a> useful for MQRC_NOT_AUTHORIZED error.</li> <li><a href="https://www.ibm.com/docs/en/ibm-mq/9.3?topic=configuring-connections-between-client-server">Configuring connections between the client and server</a>: </li> </ul> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../../req-reply-jms/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Artemis JMS Req-ReplyTo"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> Artemis JMS Req-ReplyTo </div> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["content.code.annotate", "content.tooltips", "navigation.instant", "navigation.tracking", "navigation.footer", "navigation.tabs.sticky"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../../assets/javascripts/bundle.ad660dcc.min.js></script> </body> </html>